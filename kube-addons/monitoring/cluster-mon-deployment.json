{
  "apiVersion": "extensions/v1beta1",
  "kind": "Deployment",
  "metadata": {
    "name": "cluster-monitor",
    "namespace": "kube-system"
  },
  "spec": {
    "replicas": 1,
    "template": {
      "metadata": {
        "labels": {
          "task": "monitoring",
          "apl-app": "cluster-monitor",
          "version": "v1"
        }
      },
      "spec": {
        "containers": [
          {
            "name": "cluster-monitor",
            "image": "applariat/cluster-monitor",
            "imagePullPolicy": "Always",
            "env": [
              {
              "name": "TOPOLOGY_REDISCOVERY_TIME",
              "value": "2"
              },
              {
                "name": "APL_AMQP_EXCHANGE_NAME",
                "valueFrom": {
                  "configMapKeyRef": {
                    "name": "global-env",
                    "key": "apl-amqp-exchange-key"
                  }
                }
              },
              {
                "name": "APL_AMQP_HOST",
                "valueFrom": {
                  "configMapKeyRef": {
                    "name": "global-env",
                    "key": "rabbit-host"
                  }
                }
              },
              {
                "name": "APL_AMQP_PORT",
                "valueFrom": {
                  "configMapKeyRef": {
                    "name": "global-env",
                    "key": "rabbit-port"
                  }
                }
              },
              {
                "name": "APL_AMQP_ROUTING_KEY",
                "valueFrom": {
                  "configMapKeyRef": {
                    "name": "global-env",
                    "key": "monitor-apl-amqp-routing-key"
                  }
                }
              },
              {
                "name": "APL_AMQP_VHOST",
                "valueFrom": {
                  "configMapKeyRef": {
                    "name": "global-env",
                    "key": "rabbit-vhost"
                  }
                }
              },
              {
                "name": "CLUSTER_ID",
                "valueFrom": {
                  "configMapKeyRef": {
                    "name": "global-env",
                    "key": "cluster-id"
                  }
                }
              },
              {
                "name": "APL_SVC_PASSWORD",
                "valueFrom": {
                  "configMapKeyRef": {
                    "name": "global-env",
                    "key": "rabbit-svc-password"
                  }
                }
              },
              {
                "name": "APL_SVC_USERNAME",
                "valueFrom": {
                  "configMapKeyRef": {
                    "name": "global-env",
                    "key": "rabbit-svc-username"
                  }
                }
              },
              {
                "name": "APPLARIAT_API_URL",
                "valueFrom": {
                  "configMapKeyRef": {
                    "name": "global-env",
                    "key": "api-url"
                  }
                }
              },
              {
              "name": "INFLUX_HOST",
              "value": "http://monitoring-influxdb:8086"
              }
            ]
          }
        ]
      }
    }
  }
}
